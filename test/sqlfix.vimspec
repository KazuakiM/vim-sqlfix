" Basic {{{
scriptencoding utf-8
source ../vim-sqlfix/autoload/sqlfix.vim
call themis#helper('command').with(themis#helper('assert')).with({'Expect': themis#helper('expect')})
"}}}

Describe vim-sqlfix
  Before all
  End

  Describe sqlfix#Fix()
    Context Simple
      "{{{
      Before each
        %delete _
        append
SELECT mem.id AS member_id,mem.name AS member_name, mem.status,  mem.address FROM   (SELECT *
    FROM member AS sub_mem) AS mem;
.
      End

      It is Normal case.
        normal! ggVGy
        Assert Equals(sqlfix#Fix(), [
          \ 'SELECT mem.id AS member_id, mem.name AS member_name, mem.status, mem.address',
          \ 'FROM (',
          \ '    SELECT *',
          \ '    FROM member AS sub_mem) AS mem;'])
      End
      It is g:sqlfix#IndentSize = 2 case.
        let g:sqlfix#IndentSize = 2
        normal! ggVGy
        Assert Equals(sqlfix#Fix(), [
          \ 'SELECT mem.id AS member_id, mem.name AS member_name, mem.status, mem.address',
          \ 'FROM (',
          \ '  SELECT *',
          \ '  FROM member AS sub_mem) AS mem;'])
        let g:sqlfix#IndentSize = 4
      End
      "}}}
    End

    Context Yii
      "{{{
      Before each
        %delete _
        append
SELECT mem.id AS member_id
 FROM member AS mem
 WHERE mem.started_at <= :started_at AND :ended_at < mem.ended_at
 AND mem.status = :active. Bound with started_at='2072-07-02 00:07:02', ended_at='2091-09-01 00:09:01', :active=1
.
      End

      It is OK case.
        normal! ggVGy
        Assert Equals(sqlfix#Fix(), [
          \ 'SELECT mem.id AS member_id',
          \ 'FROM member AS mem',
          \ "WHERE mem.started_at <= '2072-07-02 00:07:02'",
          \ "AND '2091-09-01 00:09:01' < mem.ended_at",
          \ 'AND mem.status = 1'])
      End
      "}}}
    End

  End
End

" vim:fdl=0:sts=2:sw=2:ts=2
